{% extends "master.html" %}
{%load static %}
{% block title %}Produtos{% endblock %}

{% block head_tags %}
<link rel="stylesheet" href="{% static 'listagem_produto/css/style.css' %}">
<link rel="stylesheet" href="{% static 'listagem_produto/css/range.css' %}">


<script defer src="{% static 'listagem_produto/js/script.js' %}"></script>
<script defer src="{% static 'listagem_produto/js/range.js' %}"></script>

<link href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'listagem_produto/css/principal.css' %}">

<style>
    
#conteudo_interno_especifico {
    background-color: #EFF2F6; 
}

#conteudo_interno_especifico section {
    font-family: 'Public Sans', sans-serif;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #EFF2F6; 
    color: #000000;
}

#conteudo_interno_especifico .header,
#conteudo_interno_especifico .filters,
#conteudo_interno_especifico .products {
    width: 100%;
    max-width: 1200px;
    padding: 20px;
}


.main-content {
display: flex;
width: 100%;
flex-wrap: wrap; /* Permite que os itens quebrem para a próxima linha */
justify-content: space-between; /* Espaçamento entre os itens */
}
.filters {
background-color: #EFF2F6;
padding: 10px;
margin-right: 20px;
width: 250px;
flex: 0 0 250px; /* Largura fixa para filtros */
}
.filters h1 {
font-size: 25px;
}
.filters div {
margin-bottom: 10px;
}
.filters label {
margin-right: 10px;
}
.filters select, .filters input {
margin-right: 20px;
width: 100%;
}
.products-section {
flex-grow: 1;
}
.products-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.products-header .sort-options {
display: flex;
align-items: center;
margin-left: auto;
}
.products-header .sort-options select {
flex: 1; /* Faz o select ocupar o espaço disponível */
min-width: 150px; /* Largura mínima para o select */
margin-left: 10px; /* Espaço à esquerda */
}

.common-button {
padding: 10px 20px;
margin: 20px auto;
background-color: #EFF2F6;
color: black;
border: 2px solid black;
cursor: pointer;
display: block;
}
/* .cartao {
margin: 10px;
padding: 20px;
width: 300px;
text-align: left;
} */
.cartao img{
border: 2px solid #d6dfe0;
width: 260px;
height: 260px;
aspect-ratio: 1 / 1; /* Isso mantém a proporção */
}
.cartao h2 {
font-size: 1.5em;
margin-bottom: 10px;
white-space: normal; 
overflow: visible; 
text-overflow: clip; 
}
.cartao p {
margin: 5px 0;
}
.cartao .price {
font-size: 1.4em;
color: #000;
}
.label-style {
font-family: 'Public Sans', sans-serif;
color: #000; /* cor preta */
}
.dropdown-menu {
display: none;
position: absolute;
background-color: black;
box-shadow: 0 2px 5px rgba(0,0,0,0.1);
padding: 10px;
list-style: none;
}
.dropdown-menu.show {
display: block;
}
.dropdown-menu li {
padding: 5px 10px;
cursor: pointer;
}
.dropdown-menu li:hover {
background-color: #f1f1f1;
}
.dropdown button {
display: none;
}
.new-div {
display: left;
width: 100%;
align-items: flex-start; 
}
.new-div h1 {
color: #000000;
}
.new-div p {
color: #979797;
}
.sort-options {
display: flex;
align-items: center;
border: 2px solid #000; 
padding: 10px;
flex-wrap: wrap;
justify-content: space-between;
margin-top: 10px;
}
form div:last-child {
display: flex;
gap: 10px;
}
button[type="submit"],
button[type="reset"] {
background-color: rgba(0, 0, 0, 0);
border: 2px solid black;
color: black;
padding: 7px 18px;
cursor: pointer; 
opacity: 0.7;
flex: 1;

}
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Poppins', sans-serif;
}
::selection {
color: #fff;
background: #17A2B8;
}
.price-input {
width: 100%;
display: flex;
margin: 30px 0 35px;
}
.price-input .field {
display: block;
width: 100%;
height: 23px;
align-items: center;
}
.field input {
width: 70px;
height: 110%;
outline: none;
font-size: 15px;
background-color: transparent;
border-radius: 5px;
text-align: center;
border-radius: 10%;
-moz-appearance: textfield;
}
input[type="number"]::-webkit-outer-spin-button,
input[type="number"]::-webkit-inner-spin-button {
-webkit-appearance: none;
}
.slider {
height: 10px;
position: relative;
background: #ddd;
border-radius: 10px;
}
.slider .progress {
height: 100%;
left: 25%;
right: 25%;
position: absolute;
border-radius: 5px;
background: #8f8e8e;
}
.range-input {
position: relative;
}
.range-input input {
position: absolute;
width: 100%;
height: 10px;
top: -20px;
background: none;
pointer-events: none;
-webkit-appearance: none;
-moz-appearance: none;
}
input[type="range"]::-webkit-slider-thumb {
height: 17px;
width: 17px;
border-radius: 50%;
background: #4f5050;
pointer-events: auto;
-webkit-appearance: none;
box-shadow: 0 0 6px rgba(0, 0, 0, 0.05);
}
input[type="range"]::-moz-range-thumb {
height: 17px;
width: 17px;
border: none;
border-radius: 50%;
background: #4f5050;
pointer-events: auto;
-moz-appearance: none;
}
.botao-filtro {
background-color: transparent;
border: 2px solid black;
color: black;
padding: 10px 20px;
cursor: pointer;
font-size: 16px;
margin-right: 10px; /* Espaço entre os botões */
}
.estrutura-filtros {
display: flex;
align-items: center;
}


</style>

{% endblock head_tags %}
{% block content %}
<section>
<div class="new-div" style="text-align: left; padding: 0; margin: 0;">
    <h1>Comprar</h1>
    <p>Junte-se aos milhares de clientes satisfeitos que já<br>
        escolheram nossa loja e descubra por que somos a<br>
        escolha número um para todas as suas necessidades!</p>    
    </div>
    
    <div class="main-content">
        <div id="filtro_desktop" class="filters">
            <h1>Filtros</h1>
            <p>Categoria</p> <br>
            <form id="formFiltros" action="" method="get">
                <input type="hidden" id="ordenar_produto" name="ordenar_produto" value="{{ ordenar_por }}">
                <div>
                    <label for="marca" class="label-style">Marca</label>
                    <select id="marca" name="marca" style="background-color: transparent; border: 1px solid #EFF2F6; color: #000;">
                        <option value="">Todas</option>
                        {% for marca in marcas %}
                        <option value="{{ marca.id }}">{{ marca.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="cor" class="label-style">Cor</label>
                    <select id="cor" name="cor" style="background-color: transparent; border: 1px solid #EFF2F6; color: #000;">
                        <option value="">Todas</option>
                        {% for cor in cores %}
                        <option value="{{ cor.id }}">{{ cor.nome }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="price-input">
                    <div class="field">
                        <span>Min</span>
                        <input type="number" class="input-min" name="precoMin" id="preco_min" value="{{precoMin}}" min="0" max="10000">
                    </div>
                    <div class="field">
                        <span>Max</span>
                        <input type="number" class="input-max" name="precoMax" id="preco_max" value="{{precoMax}}" min="0" max="10000">
                    </div>
                </div>
                <br>
                <div class="slider">
                    <div class="progress" style="left: 25%; right: 25%;"></div>
                </div>
                <div class="range-input">
                    <input type="range" class="range-min"  min="0" max="10000" value="{{precoMin}}" step="100">
                    <input type="range" class="range-max"  min="0" max="10000" value="{{precoMax}}" step="100">
                </div>
                <br>
            
                <div class="dropdown">
                    <button id="bordenarpor" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="fa fa-exchange fa-rotate-90" aria-hidden="true"></span> Ordenar por
                        <span class="caret"></span>
                    </button>
                </div>
                
                <div class="estrutura-filtros">
                    <button type="submit" class="botao-filtro" id="aplicarFiltros">Aplicar</button>
                    <button type="reset" class="botao-filtro" id="btnLimparFiltros">Limpar</button>
                    
                </div>
            </form>    
        </div>

        <div class="products-section">
            <div class="products-header">
                <div class="sort-options">
                    Ordenar por 
                    <select id="ordenar" name="ordenar_por" style="background-color: #EFF2F6; border: none; color: black; font-family: 'Inter', sans-serif; font-weight: bold;">
                        <option value="">Selecione</option>
                        <option value="preco_asc">Do Mais Barato</option>
                        <option value="preco_desc">Do Mais Caro</option>
                    </select>
                </div>
            </div>
            <div class="Qtd" style="text-align: right;">
                <p>Mostrando {{ total_produtos }} Produtos</p>
            </div>
            <div class="products">
            <div class="container">
                <div class="row">
                    {% for produto in produtos %}
                    <div class="cartao_produto col-lg-4 col-md-8 col-sm-12">
                        <div class="card" style="background-color: transparent; border: none;" data-popularidade="{{ produto.popularidade }}">
                            <a href="{% url 'produto_detalhes' produto.id %}">
                                <img style="border: 2px solid #d6dfe0; width: 260px; height: 260px;" src="/media/{{ produto.imagem1 }}" alt="{{ produto.modelo }}" style="display: block;">
                            </a>
                            <h2>{{ produto.modelo }}</h2>
                            <p><strong>Marca:</strong>{{ produto.marca }}</p>
                            <p><strong>Cor:</strong> {{ produto.cor }}</p>
                            <p><strong>Disponíveis:</strong> {{ produto.qtd_estoque }}</p>
                            <p class="price"><strong>Preço:</strong> R$ {{ produto.preco }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            </div>
        </div>
    </div>
    <button id="load-more" class="load-more common-button">Carregar mais produtos</button>
    <button id="show-less" class="show-less common-button" style="display: none;">Mostrar menos produtos</button>

    
    <script>
                
        
        // Função para definir a ordem de classificação ao selecionar uma opção
        function setSortOrder(value) {
        document.getElementById('ordenar_por').value = value;
        // Opcionalmente, feche o menu suspenso aqui se necessário
    }
    // Adiciona um evento de clique ao botão que abre o menu suspenso de ordenação
    document.getElementById('bordenarpor').addEventListener('click', function() {
        document.querySelector('.dropdown-menu').classList.toggle('show');
    });

    // Adiciona um evento de clique a cada item do menu suspenso
    document.querySelectorAll('.dropdown-menu li').forEach(function(item) {
        item.addEventListener('click', function() {
            document.querySelector('.dropdown-menu').classList.remove('show');
            document.getElementById('ordenar_por').value = this.getAttribute('data-value');
            // Adicionar a lógica para ordenar os produtos
            console.log('Ordenar por:', this.getAttribute('data-value'));
        });
    });

    let visibleProducts = 6; // Número de produtos visíveis inicialmente
    const products = document.querySelectorAll('.cartao_produto');

    // Mostrar os primeiros 6 produtos
    for (let i = 0; i < products.length; i++) {
        if (i < visibleProducts) {
            products[i].style.display = 'block'; // Exibe o produto
        }else{
            products[i].style.display = 'none'; // Oculta o produto
        }
    }

    // Carregar mais produtos ao clicar no botão "Carregar mais produtos"
    document.querySelector('.load-more').addEventListener('click', function() {
        const totalProducts = products.length;
        const nextVisibleProducts = visibleProducts + 6;

        for (let i = visibleProducts; i < nextVisibleProducts && i < totalProducts; i++) {
            products[i].style.display = 'block';
        }

        visibleProducts = nextVisibleProducts; // Atualiza o contador de produtos visíveis

        // Mostrar botão "Mostrar menos" se houver mais produtos para mostrar
        if (visibleProducts < totalProducts) {
            document.querySelector('.show-less').style.display = 'block';
            document.querySelector('#show-less').style.display = 'block';
        }

        // Ocultar botão "Carregar mais" se todos os produtos estiverem visíveis
        if (visibleProducts >= totalProducts) {
            this.style.display = 'none';
        }
    });

    // Mostrar menos produtos ao clicar no botão "Mostrar menos"
    document.querySelector('.show-less').addEventListener('click', function() {
        const productsToHide = 6;

        for (let i = products.length-1; i >= products.length - productsToHide; i--) {
            products[i].style.display = 'none'; // Oculta o produto
        }

        // // Ocultar os últimos 6 produtos visíveis
        // for (
        //     let i = visibleProducts - 1;
        //     i >= visibleProducts - productsToHide && i >= 0;
        //     i--) {
        //     products[i].style.display = 'none';
        // }

        // visibleProducts -= productsToHide; // Atualiza o contador de produtos visíveis

        // // Ocultar o botão "Mostrar menos" se não houver produtos a mostrar
        // if (visibleProducts <= 6) {
        //     this.style.display = 'none';
        // }

        // Mostrar o botão "Carregar mais" se não estiver exibindo todos os produtos
        if (visibleProducts < totalProducts) {
            document.querySelector('.load-more').style.display = 'block';
        }
    });

    // Campo de popularidade
    document.addEventListener('DOMContentLoaded', function () {
        const ordenarSelect = document.getElementById('ordenar');
        const produtos = Array.from(document.querySelectorAll('.cartao'));

        // Adiciona um evento de mudança ao seletor de ordenação
        ordenarSelect.addEventListener('change', function () {
            const sortBy = this.value;

            // Lógica para ordenar produtos com base na popularidade
            if (sortBy === 'populares') {
                produtos.sort((a, b) => {
                    return b.dataset.popularidade - a.dataset.popularidade; // Ordenar do mais popular para o menos popular
                });
            } else if (sortBy === 'menos_populares') {
                produtos.sort((a, b) => {
                    return a.dataset.popularidade - b.dataset.popularidade; // Ordenar do menos popular para o mais popular
                });
            }

            // Limpa a seção de produtos antes de adicionar os produtos ordenados
            const productsContainer = document.querySelector('.products');
            productsContainer.innerHTML = '';

            // Adiciona os produtos ordenados ao DOM
            produtos.forEach(produto => {
                productsContainer.appendChild(produto);
            });
        });
    });

    // Campo de filtragem
    document.addEventListener('DOMContentLoaded', function () {
        const aplicarFiltrosBtn = document.getElementById('aplicarFiltros');
        const limparFiltrosBtn = document.getElementById('btnLimparFiltros');
        const marcaSelect = document.getElementById('marca');
        const corSelect = document.getElementById('cor');
        const precoMinInput = document.getElementById('precoMin');
        const precoMaxInput = document.getElementById('precoMax');
        const produtos = Array.from(document.querySelectorAll('.cartao'));

        // Função para filtrar produtos com base em critérios selecionados
        function applyFilters() {
            const selectedMarca = marcaSelect.value;
            const selectedCor = corSelect.value;
            const precoMin = Number(precoMinInput.value);
            const precoMax = Number(precoMaxInput.value);

            produtos.forEach(produto => {
                const marcaMatch = selectedMarca === '' || produto.dataset.marca === selectedMarca;
                const corMatch = selectedCor === '' || produto.dataset.cor === selectedCor;
                const precoProduto = Number(produto.dataset.preco);
                const precoMatch = precoProduto >= precoMin && precoProduto <= precoMax;

                produto.style.display = (marcaMatch && corMatch && precoMatch) ? 'block' : 'none';
            });
        }

    // Função para limpar todos os filtros
        function clearFilters() {
            marcaSelect.value = '';
            corSelect.value = '';
            precoMinInput.value = precoMinInput.min; // Redefinir para o mínimo
            precoMaxInput.value = precoMaxInput.max; // Redefinir para o máximo

            produtos.forEach(produto => {
                produto.style.display = 'block'; // Mostrar todos os produtos
            });
        }

        aplicarFiltrosBtn.addEventListener('click', applyFilters);
        limparFiltrosBtn.addEventListener('click', clearFilters);
    });


    // Script do range de preço
    const rangeInput = document.querySelectorAll(".range-input input"),
    priceInput = document.querySelectorAll(".price-input input"),
    range = document.querySelector(".slider .progress");
    let priceGap = 100;

    // Atualiza o slider e os campos de preço ao digitar nos inputs
    priceInput.forEach(input =>{
        input.addEventListener("input", e =>{
            let minPrice = parseInt(priceInput[0].value),
            maxPrice = parseInt(priceInput[1].value);

            if((maxPrice - minPrice >= 1) && maxPrice <= rangeInput[1].max){
                if(e.target.className === "input-min"){
                    rangeInput[0].value = minPrice;
                    range.style.left = ((minPrice / rangeInput[0].max) * 100) + "%";
                }else{
                    rangeInput[1].value = maxPrice;
                    range.style.right = 100 - (maxPrice / rangeInput[1].max) * 100 + "%";
                }
            }

            //rangeInputReload();
        });
    });

    // Atualiza o slider ao alterar o range
    rangeInput.forEach(input =>{
        input.addEventListener("input", rangeInputReload);
    });

    // Função para aplicar alterações do range
    function rangeInputReload(e){
            let minVal = parseInt(rangeInput[0].value),
            maxVal = parseInt(rangeInput[1].value);

            if((maxVal - minVal) < priceGap){
                if(e.target.className === "range-min"){
                    rangeInput[0].value = maxVal - priceGap; // Ajusta o valor mínimo
                }else{
                    rangeInput[1].value = minVal + priceGap; // Ajusta o valor máximo
                }
            }else{
                priceInput[0].value = minVal; // Atualiza o input de preço mínimo
                priceInput[1].value = maxVal; // Atualiza o input de preço máximo
                range.style.left = ((minVal / rangeInput[0].max) * 100) + "%"; // Atualiza a posição do slider
                range.style.right = 100 - (maxVal / rangeInput[1].max) * 100 + "%"; // Atualiza a posição do slider
            }
        }



    // Limpa filtros e redefine o range ao clicar no botão "Limpar filtros"
    formFiltros = document.getElementById('formFiltros');
    btnLimparFiltros = document.getElementById('btnLimparFiltros');
    btnLimparFiltros.addEventListener('click', function() { 
        rangeInput[0].value = 0; // Redefine o valor mínimo
        rangeInput[1].value = 10000; // Redefine o valor máximo
        rangeInputReload(); // Atualiza o slider
        formFiltros.submit(); // Submete o formulário
    });
    
    // Sincroniza o valor do campo de ordenação ao alterar o seletor
    ordenarPor = document.getElementById('ordenar_produto');
    selectOrdenar = document.getElementById('ordenar');
    selectOrdenar.addEventListener('change', function() {
        ordenarPor.value = selectOrdenar.value; // Atualiza o valor do campo oculto
    });
    

    // Aplica o estado inicial do range
    rangeInputReload();

    // Reaplica os filtros ao recarregar a página
    selectOrdenar.value = ordenarPor.value; // Sincroniza o seletor com o valor inicial

function aplicarFiltros() {
        const marcaSelecionada = document.getElementById('marca').value;
        const corSelecionada = document.getElementById('cor').value;

        // Para depuração, veja se os valores estão sendo capturados corretamente
        console.log('Marca selecionada:', marcaSelecionada);
        console.log('Cor selecionada:', corSelecionada);

        // Aqui você pode implementar a lógica para filtrar produtos
        // Exemplo fictício de lógica que poderia ser usada
        // Se você tiver uma lista de produtos no frontend, filtre-a aqui
    }

    // Adiciona os eventos de mudança
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('marca').addEventListener('change', aplicarFiltros);
        document.getElementById('cor').addEventListener('change', aplicarFiltros);
    });
    </script>
</section>
    {% endblock %}

