{% extends "master.html" %}

{% block content %}
    <div class="container">
        <h1 id="titulo">Cadastrar Cor</h1>

        <form action="{% url 'cor_cadastrar_atualizar' %}" method="POST">
            {% csrf_token %}
            <input type="hidden" name="id" id="id_da_cor" value="-1">
            <div class="mb-3">
                <input type="text" id="nome" name="nome" class="form-control" placeholder="Digite aqui o nome da cor que você quer cadastrar" required>
            </div>
            <div class="mb-3 d-flex justify-content-start align-items-center">
                <button type="button" id="btnSelecionarCor" class="btn btn-dark me-2" style="background-color: black; color: white;">Selecionar Cor</button>
                <button type="submit" class="btn btn-dark me-2" id="btnSalvar">Cadastrar Cor</button>
                <input type="button" class="btn btn-dark" id="btnCancelar" value="Cancelar" />
            </div>
            <div id="mensagem" style="display: none; margin-top: 5px; color: #555;">
                Clique abaixo para selecionar a cor
            </div>
            <div id="corPalette" style="display: none; margin-top: 10px;">
                <input type="color" id="codigo_hex" name="codigo_hex" class="form-control" required>
            </div>
        </form>

        <br>
        <table class="table">
            <thead>
                <tr>
                    <td>Id</td>
                    <td>Nome da Cor</td>
                    <td>Cor</td>
                    <td>Controles</td>
                </tr>
            </thead>
            <tbody>
                {% for cor in cores %}
                    <tr id="cor{{ cor.id }}">
                        <td>{{ cor.id }}</td>
                        <td>{{ cor.nome }}</td>
                        <td>
                            <div class="cor-circulo" style="background-color: {{ cor.codigo_hex }};"></div>
                        </td>
                        <td>
                            <button class="btn btn-primary btnAtualizar" data-id="{{ cor.id }}">Atualizar</button>
                            <a class="btn btn-danger" href="{% url 'cor_deletar' cor.id %}">Deletar</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <style>
        .cor-circulo {
            width: 30px; /* Largura do círculo */
            height: 30px; /* Altura do círculo */
            border-radius: 50%; /* Faz o círculo */
            display: inline-block; /* Permite que o círculo seja exibido em linha */
            border: 1px solid #000; /* Borda opcional */
        }
    </style>

    <script>
        const titulo = document.querySelector("#titulo");
        const btnSalvar = document.querySelector("#btnSalvar");
        const idForm = document.querySelector("#id_da_cor");
        const nomeForm = document.querySelector("#nome");
        const cod_hexForm = document.querySelector("#codigo_hex");
        const btnSelecionarCor = document.querySelector("#btnSelecionarCor");
        const corPalette = document.querySelector("#corPalette");
        const mensagem = document.querySelector("#mensagem");
        const btnAtualizar = document.querySelectorAll(".btnAtualizar");
        const btnCancelar = document.querySelector("#btnCancelar");

        // Exibir seletor de cor e mensagem ao clicar no botão "Selecionar Cor"
        btnSelecionarCor.addEventListener("click", () => {
            corPalette.style.display = "block"; // Mostra o seletor de cor
            cod_hexForm.focus(); // Foca no seletor de cor
            mensagem.style.display = "block"; // Mostra a mensagem
        });

        btnAtualizar.forEach((btn) => {
            btn.addEventListener("click", selecionarCor);
        });

        btnCancelar.addEventListener("click", limparForm);

        function limparForm() {
            idForm.value = "-1";
            nomeForm.value = "";
            cod_hexForm.value = "#000000";
            corPalette.style.display = "none"; // Esconde o seletor de cor
            mensagem.style.display = "none"; // Esconde a mensagem

            // Reseta o título e o botão "Salvar"
            titulo.textContent = "Cadastrar Cor";
            btnSalvar.textContent = "Cadastrar Cor"; // Volta a ser "Cadastrar Cor"
        }

        function selecionarCor(e) {
            const idLinha = e.target.getAttribute("data-id");
            const linha = document.querySelector("#cor" + idLinha);
            const dados = linha.querySelectorAll("td");
            
            idForm.value = dados[0].textContent;
            nomeForm.value = dados[1].textContent;
            const corSelecionada = dados[2].querySelector('.cor-circulo').style.backgroundColor;

            cod_hexForm.value = corSelecionada;

            titulo.textContent = "Atualizar a cor: " + idLinha;
            btnSalvar.textContent = "Atualizar"; // Muda o texto para "Atualizar"
        }
    </script>
{% endblock %}
